<!-- Partial para lista de movimentos com filtros e paginação -->
<div id="movimentos-container">
    <!-- Barra de filtros -->
    <div class="flex flex-wrap items-center gap-3 mb-4">
        <select name="tipo" id="filtro-tipo"
            hx-get="{% url 'core:movimentos_list' %}"
            hx-target="#movimentos-container"
            hx-swap="outerHTML"
            hx-include="#filtro-tipo, #filtro-caixa"
            class="text-xs px-3 py-2 rounded-lg border border-slate-200 dark:border-border-dark bg-white dark:bg-background-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all">
            <option value="">Todos os tipos</option>
            <option value="ENTRADA" {% if filtro_tipo == 'ENTRADA' %}selected{% endif %}>Entrada</option>
            <option value="SAIDA" {% if filtro_tipo == 'SAIDA' %}selected{% endif %}>Saída</option>
            <option value="SUPRIMENTO" {% if filtro_tipo == 'SUPRIMENTO' %}selected{% endif %}>Suprimento</option>
            <option value="SANGRIA" {% if filtro_tipo == 'SANGRIA' %}selected{% endif %}>Sangria</option>
            <option value="ESTORNO" {% if filtro_tipo == 'ESTORNO' %}selected{% endif %}>Estorno</option>
        </select>

        {% if is_gerente %}
        <select name="caixa" id="filtro-caixa"
            hx-get="{% url 'core:movimentos_list' %}"
            hx-target="#movimentos-container"
            hx-swap="outerHTML"
            hx-include="#filtro-tipo, #filtro-caixa"
            class="text-xs px-3 py-2 rounded-lg border border-slate-200 dark:border-border-dark bg-white dark:bg-background-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all">
            <option value="">Todos os caixas</option>
            {% for c in caixas %}
            <option value="{{ c.pk }}" {% if filtro_caixa == c.pk|stringformat:'s' %}selected{% endif %}>{{ c.identificador }}</option>
            {% endfor %}
        </select>
        {% else %}
        <input type="hidden" id="filtro-caixa" name="caixa" value="">
        {% endif %}

        <button type="button"
            hx-get="{% url 'core:movimentos_list' %}"
            hx-target="#movimentos-container"
            hx-swap="outerHTML"
            class="ml-auto text-xs px-3 py-2 rounded-lg bg-slate-100 dark:bg-background-dark hover:bg-slate-200 dark:hover:bg-border-dark text-slate-600 dark:text-slate-300 flex items-center gap-1 transition-all">
            <span class="material-symbols-outlined text-sm">refresh</span>
            Atualizar
        </button>
    </div>

    <!-- Cards de movimentos -->
    <div class="space-y-2">
        {% for mov in movimentos %}
        {% include "caixa/partials/_movimento_card.html" with mov=mov show_tipo=True show_checkbox=False show_origem=False show_caixa=True %}
        {% empty %}
        <div class="flex flex-col items-center justify-center py-8 text-slate-500">
            <span class="material-symbols-outlined text-3xl opacity-30 mb-2">receipt_long</span>
            <p class="text-sm">Nenhuma movimentação encontrada.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Paginação -->
    {% if page_obj.has_other_pages %}
    <div class="flex items-center justify-between mt-4 pt-4 border-t border-slate-100 dark:border-border-dark">
        <p class="text-xs text-slate-500">
            Mostrando {{ page_obj.start_index }}-{{ page_obj.end_index }} de {{ page_obj.paginator.count }} movimentos
        </p>
        <div class="flex items-center gap-1">
            {% if page_obj.has_previous %}
            <button type="button"
                hx-get="{% url 'core:movimentos_list' %}?page={{ page_obj.previous_page_number }}&tipo={{ filtro_tipo }}&caixa={{ filtro_caixa }}"
                hx-target="#movimentos-container"
                hx-swap="outerHTML"
                class="p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-border-dark text-slate-500 transition-all">
                <span class="material-symbols-outlined text-sm">chevron_left</span>
            </button>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <span class="px-3 py-1 rounded-lg bg-primary text-white text-xs font-bold">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <button type="button"
                    hx-get="{% url 'core:movimentos_list' %}?page={{ num }}&tipo={{ filtro_tipo }}&caixa={{ filtro_caixa }}"
                    hx-target="#movimentos-container"
                    hx-swap="outerHTML"
                    class="px-3 py-1 rounded-lg hover:bg-slate-100 dark:hover:bg-border-dark text-slate-500 text-xs font-medium transition-all">{{ num }}</button>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <button type="button"
                hx-get="{% url 'core:movimentos_list' %}?page={{ page_obj.next_page_number }}&tipo={{ filtro_tipo }}&caixa={{ filtro_caixa }}"
                hx-target="#movimentos-container"
                hx-swap="outerHTML"
                class="p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-border-dark text-slate-500 transition-all">
                <span class="material-symbols-outlined text-sm">chevron_right</span>
            </button>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
