<div class="fixed inset-0 z-[60] flex items-center justify-center p-4 sm:p-6" 
     role="dialog" 
     aria-modal="true"
     x-data="{ show: true }"
     x-show="show"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
     x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
     x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">

    <!-- Backdrop -->
    <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" 
         @click="show = false; setTimeout(() => $el.closest('#modal-global-container').innerHTML = '', 300);"></div>

    <!-- Modal Panel -->
    <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-surface-dark text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-slate-200 dark:border-border-dark">
        <div class="px-4 pb-4 pt-5 sm:p-6 sm:pb-4 border-b border-slate-100 dark:border-border-dark">
            <div class="sm:flex sm:items-start">
                <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-primary/10 sm:mx-0 sm:h-10 sm:w-10">
                    <span class="material-symbols-outlined text-primary">person</span>
                </div>
                <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                    <h3 class="text-lg font-semibold leading-6 text-slate-900 dark:text-white" id="modal-title">Meus Dados</h3>
                    <div class="mt-2">
                        <p class="text-sm text-slate-500 dark:text-slate-400">Atualize suas informações de perfil.</p>
                    </div>
                </div>
                <button type="button" 
                        class="absolute right-4 top-4 text-slate-400 hover:text-slate-500"
                        @click="show = false; setTimeout(() => $el.closest('#modal-global-container').innerHTML = '', 300);">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
        
        <form hx-post="{% url 'core:user_profile' %}" hx-target="#modal-global-container" class="px-4 py-4 sm:p-6">
            {% csrf_token %}
            <div class="grid grid-cols-1 gap-4">
                <!-- Nome -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label for="id_first_name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Nome</label>
                        <input type="text" name="first_name" id="id_first_name" value="{{ form.first_name.value|default:'' }}" 
                               class="block w-full rounded-lg border-slate-200 dark:border-border-dark bg-slate-50 dark:bg-background-dark text-slate-900 dark:text-white focus:border-primary focus:ring-primary sm:text-sm">
                        {% if form.first_name.errors %}
                        <p class="text-xs text-danger mt-1">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    <div class="space-y-1">
                        <label for="id_last_name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Sobrenome</label>
                        <input type="text" name="last_name" id="id_last_name" value="{{ form.last_name.value|default:'' }}" 
                               class="block w-full rounded-lg border-slate-200 dark:border-border-dark bg-slate-50 dark:bg-background-dark text-slate-900 dark:text-white focus:border-primary focus:ring-primary sm:text-sm">
                    </div>
                </div>

                <!-- Email (Read-only) -->
                <div class="space-y-1">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">E-mail</label>
                    <input type="email" value="{{ user.email }}" disabled
                           class="block w-full rounded-lg border-slate-200 dark:border-border-dark bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 cursor-not-allowed sm:text-sm">
                    <p class="text-xs text-slate-400">O e-mail é usado para login e não pode ser alterado.</p>
                </div>

                <!-- CPF -->
                <div class="space-y-1">
                    <label for="id_cpf" class="block text-sm font-medium text-slate-700 dark:text-slate-300">CPF</label>
                    <input type="text" name="cpf" id="id_cpf" value="{{ form.cpf.value|default:'' }}" 
                           class="block w-full rounded-lg border-slate-200 dark:border-border-dark bg-slate-50 dark:bg-background-dark text-slate-900 dark:text-white focus:border-primary focus:ring-primary sm:text-sm"
                           x-mask="999.999.999-99" placeholder="000.000.000-00">
                </div>
            </div>

            <div class="mt-6 flex items-center justify-end gap-3 border-t border-slate-100 dark:border-border-dark pt-4">
                <button type="button" 
                        class="rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-surface-dark px-4 py-2 text-sm font-semibold text-slate-700 dark:text-slate-200 shadow-sm hover:bg-slate-50 dark:hover:bg-background-dark"
                        @click="show = false; setTimeout(() => $el.closest('#modal-global-container').innerHTML = '', 300);">
                    Cancelar
                </button>
                
                <button type="submit" 
                        class="flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">
                    <span class="material-symbols-outlined text-sm">save</span>
                    Salvar Alterações
                </button>
            </div>
        </form>
    </div>
</div>
