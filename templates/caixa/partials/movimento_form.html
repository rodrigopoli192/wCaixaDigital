{% load widget_tweaks %}

<form hx-post="{% url 'caixa:novo_movimento' abertura.pk %}" hx-swap="outerHTML" class="space-y-6">
    {% csrf_token %}

    <div class="flex justify-between items-center mb-6 border-b border-slate-100 dark:border-border-dark pb-4">
        <h3 class="text-xl font-bold text-slate-800 dark:text-slate-100">Novo Movimento</h3>
        <button type="button" @click="open = false" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
            <span class="material-symbols-outlined">close</span>
        </button>
    </div>
    
    {% if form.non_field_errors %}
    <div class="p-4 mb-4 text-sm text-danger rounded-lg bg-danger/10 border border-danger/20" role="alert">
        {{ form.non_field_errors }}
    </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-1">
            <label for="{{ form.tipo.id_for_label }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                Tipo de Movimento
            </label>
            {% render_field form.tipo class="w-full rounded-lg border-slate-300 dark:border-border-dark dark:bg-background-dark dark:text-slate-200 focus:border-primary focus:ring-primary shadow-sm" %}
            {% if form.tipo.errors %}
                <p class="text-sm text-danger mt-1">{{ form.tipo.errors.0 }}</p>
            {% endif %}
        </div>

        <div class="space-y-1">
            <label for="{{ form.forma_pagamento.id_for_label }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                Forma de Pagamento
            </label>
            {% render_field form.forma_pagamento class="w-full rounded-lg border-slate-300 dark:border-border-dark dark:bg-background-dark dark:text-slate-200 focus:border-primary focus:ring-primary shadow-sm" %}
            {% if form.forma_pagamento.errors %}
                <p class="text-sm text-danger mt-1">{{ form.forma_pagamento.errors.0 }}</p>
            {% endif %}
        </div>
    </div>

    <div class="space-y-1">
        <label for="{{ form.valor.id_for_label }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
            Valor
        </label>
        <div class="relative mt-1 rounded-md shadow-sm">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <span class="text-slate-500 sm:text-sm">R$</span>
            </div>
            {% render_field form.valor class="block w-full rounded-lg border-slate-300 dark:border-border-dark dark:bg-background-dark dark:text-slate-200 pl-10 focus:border-primary focus:ring-primary sm:text-sm" placeholder="0,00" %}
        </div>
        {% if form.valor.errors %}
            <p class="text-sm text-danger mt-1">{{ form.valor.errors.0 }}</p>
        {% endif %}
    </div>

    <div class="space-y-1">
        <label for="{{ form.descricao.id_for_label }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
            Descrição
        </label>
        {% render_field form.descricao class="w-full rounded-lg border-slate-300 dark:border-border-dark dark:bg-background-dark dark:text-slate-200 focus:border-primary focus:ring-primary shadow-sm" rows="2" %}
        {% if form.descricao.errors %}
            <p class="text-sm text-danger mt-1">{{ form.descricao.errors.0 }}</p>
        {% endif %}
    </div>

    <div class="space-y-1">
        <label for="{{ form.cliente.id_for_label }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
            Cliente <span class="text-slate-400 font-normal">(Opcional)</span>
        </label>
        {% render_field form.cliente class="w-full rounded-lg border-slate-300 dark:border-border-dark dark:bg-background-dark dark:text-slate-200 focus:border-primary focus:ring-primary shadow-sm" %}
        <p class="text-xs text-slate-500">Vincular a um tomador de serviço</p>
        {% if form.cliente.errors %}
            <p class="text-sm text-danger mt-1">{{ form.cliente.errors.0 }}</p>
        {% endif %}
    </div>

    <div class="space-y-1">
        <label for="{{ form.observacoes.id_for_label }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
            Observações
        </label>
        {% render_field form.observacoes class="w-full rounded-lg border-slate-300 dark:border-border-dark dark:bg-background-dark dark:text-slate-200 focus:border-primary focus:ring-primary shadow-sm" rows="2" %}
         {% if form.observacoes.errors %}
            <p class="text-sm text-danger mt-1">{{ form.observacoes.errors.0 }}</p>
        {% endif %}
    </div>

    <div class="flex justify-end gap-3 pt-4 border-t border-slate-100 dark:border-border-dark">
        <button type="button" @click="open = false" class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-white dark:bg-background-dark border border-slate-300 dark:border-border-dark rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all">
            Cancelar
        </button>
        <button type="submit" class="inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all">
             {% if is_loading %}
                <span class="animate-spin -ml-1 mr-3 h-5 w-5 text-white material-symbols-outlined">refresh</span>
                Salvando...
             {% else %}
               <span class="material-symbols-outlined mr-2 text-sm">check_circle</span>
               Registrar Movimento
             {% endif %}
        </button>
    </div>
</form>
